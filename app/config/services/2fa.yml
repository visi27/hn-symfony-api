parameters:
  app_user.twofactor.email.provider.class: AppBundle\Security\TwoFactor\Email\Helper
  app_user.twofactor.google.provider.class: AppBundle\Security\TwoFactor\Google\Helper
  app_user.twofactor.google.class: Google\Authenticator\GoogleAuthenticator

  app_user.twofactor.interactive_login_listener.class: AppBundle\Security\TwoFactor\InteractiveLoginListener
  app_user.twofactor.request_listener.class: AppBundle\Security\TwoFactor\RequestListener

services:
  app.security.twofactor.google:
    class: "%app_user.twofactor.google.class%"
  app.security.twofactor.google.provider:
    class: "%app_user.twofactor.google.provider.class%"
    arguments: ["%app.security.param.servername%", "@app.security.twofactor.google", "@app.security.encryption_service"]

  app.security.twofactor.email.provider:
    class: "%app_user.twofactor.email.provider.class%"
    arguments: ["@doctrine.orm.entity_manager", "@swiftmailer.mailer"]

  app.security.twofactor.provide_factory:
    class: AppBundle\Security\TwoFactor\HelperFactory
    arguments: ["@app.security.twofactor.email.provider", "@app.security.twofactor.google.provider"]

  app.security.twofactor.interactive_login_listener:
    class: "%app_user.twofactor.interactive_login_listener.class%"
    arguments: ["@app.security.twofactor.provide_factory"]
    tags:
      - { name: kernel.event_listener, event: security.interactive_login, method: onSecurityInteractiveLogin }

  app.security.twofactor.request_listener:
    class: "%app_user.twofactor.request_listener.class%"
    arguments: ["@app.security.twofactor.provide_factory","@security.token_storage", "@templating","@router"]
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onCoreRequest, priority: -1 }

  app.doctrine.google_auth_listener:
    class: AppBundle\Doctrine\GoogleAuthKeyListener
    arguments: ["@app.security.encryption_service"]
    tags:
      - {name: doctrine.event_subscriber}